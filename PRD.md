# [PRD] 선결제 관리 플랫폼 커밍스 (Comings - Prepaid Management Platform)

## 1. 프로젝트 개요
* **프로젝트명:** 선결제 관리 플랫폼 커밍스 (Comings)
* **운영 URL:** https://www.comings.co.kr
* **배경:** 기존 구글 스프레드시트로 관리하던 선결제 장부의 휴먼 에러를 방지하고, 실시간 잔액 조회 및 편리한 인터페이스를 통해 업무 효율을 높임
* **주요 목표:** * 고객별 실시간 잔액 관리
    * 충전 및 차감 내역의 투명한 기록
    * 모바일/태블릿에 최적화된 빠른 검색 및 입력 환경 제공

---

## 2. 기술 스택 (Tech Stack)
* **Frontend:** React (Vite)
* **Backend:** FastAPI (Python)
* **Database:** Supabase (PostgreSQL)
* **Deployment:** Vercel

---

## 3. 핵심 기능 (Core Features)

### 3.0. 인증 및 보안 (Authentication & Security)

#### 3.0.1. 이메일/비밀번호 로그인
* **로그인 방식:** 이메일 + 비밀번호 기반 인증
* **회원가입:** 이메일, 비밀번호, 상점명 입력으로 신규 상점 등록
* **자동 로그인:** 기기별 로그인 상태 유지 (선택적 활성화)
* **비밀번호 정책:**
    * 최소 8자 이상
    * 영문, 숫자 조합 필수

#### 3.0.2. 데이터 보호 PIN
* **적용 범위:** 민감한 데이터 수정 작업 시 4자리 숫자 비밀번호 입력 필수
    * 고객 정보 수정/삭제
    * 거래 내역 취소(Rollback)
    * 충전 금액 수정
    * 상점 설정 변경
* **PIN 설정:** 최초 상점 등록 시 필수 설정, 이후 변경 가능
* **보안 정책:**
    * 5회 연속 실패 시 1분간 입력 차단
    * PIN 분실 시 비밀번호 재인증 후 재설정

### 3.1. 고객 관리 (Customer Management)
* **신규 등록:** 이름과 연락처 뒷자리(4자리)를 기반으로 신규 고객 등록
* **고객 검색:** 이름 또는 연락처 뒷자리 입력 시 실시간 필터링 검색
* **프로필:** 고객별 총 충전액, 총 사용액, 현재 잔액 표시

### 3.2. 충전 및 결제 (Transaction Management)
* **선불 충전 (Charge):**
    * 입력 항목: 실제 결제액, 서비스 금액(보너스), 결제 수단(카드/현금/계좌이체)
    * 결과: (실제 결제액 + 서비스 금액)이 현재 잔액에 합산됨
* **서비스 이용 (Deduct):**
    * 입력 항목: 사용 금액, 비고(주문 메뉴)
    * 결과: 현재 잔액에서 사용 금액만큼 차감
* **거래 취소:** 잘못 입력된 거래 내역에 대한 취소(Rollback) 기능

### 3.3. 대시보드 및 리포트
* **금일 요약:** 오늘 총 충전 금액 및 총 차감 금액 합계 표시
* **전체 잔액:** 현재 시스템에 예치된 모든 고객의 잔액 총계 확인

### 3.4. 통계 분석 대시보드 (Analytics Dashboard)
* **기간별 매출 현황:**
    * 일간/주간/월간 충전 금액 및 사용 금액 추이 그래프
    * 기간 선택을 통한 상세 조회
* **고객 분석:**
    * 상위 충전 고객 순위 (Top 10)
    * 신규 고객 등록 추이
    * 고객별 방문 빈도
* **결제 수단별 현황:**
    * 카드/현금/계좌이체 비율 파이 차트
    * 기간별 결제 수단 추이
* **인기 메뉴 분석:**
    * 비고(주문 메뉴) 기반 자주 주문되는 메뉴 분석
    * 워드 클라우드 또는 순위 표시

---

## 4. 데이터베이스 설계 (Database Schema)

### 4.1. `shops` 테이블 (상점 정보)
| 컬럼명 | 타입 | 설명 |
| :--- | :--- | :--- |
| `id` | UUID (PK) | 상점 고유 식별자 |
| `email` | String (Unique) | 로그인 이메일 |
| `password_hash` | String | 비밀번호 해시값 |
| `name` | String | 상점명 |
| `pin_hash` | String | 4자리 PIN 해시값 |
| `pin_failed_count` | Integer | PIN 연속 실패 횟수 (Default: 0) |
| `pin_locked_until` | Timestamp | PIN 잠금 해제 시간 (Nullable) |
| `created_at` | Timestamp | 상점 등록일 |
| `updated_at` | Timestamp | 최종 수정일 |

### 4.2. `customers` 테이블
| 컬럼명 | 타입 | 설명 |
| :--- | :--- | :--- |
| `id` | UUID (PK) | 고유 식별자 |
| `shop_id` | UUID (FK) | 소속 상점 ID |
| `name` | String | 고객 성함 |
| `phone_suffix` | String(4) | 연락처 뒷자리 (Index 설정 권장) |
| `current_balance` | Integer | 현재 보유 잔액 (Default: 0) |
| `created_at` | Timestamp | 최초 등록일 |

### 4.3. `transactions` 테이블
| 컬럼명 | 타입 | 설명 |
| :--- | :--- | :--- |
| `id` | UUID (PK) | 거래 고유 ID |
| `customer_id` | UUID (FK) | 관련 고객 ID |
| `type` | Enum | 구분 (CHARGE, DEDUCT, CANCEL) |
| `amount` | Integer | 거래 총액 (합산 또는 차감액) |
| `actual_payment` | Integer | 실제 수납액 (충전 시) |
| `service_amount` | Integer | 서비스 증정액 (충전 시) |
| `payment_method` | String | 결제 수단 (카드, 현금, 이체) |
| `note` | Text | 비고 (주문 메뉴 등) |
| `created_at` | Timestamp | 거래 일시 |

---

## 5. UI/UX 요구사항
* **반응형 디자인:** 카운터 태블릿(iPad 등)에서 사용하기 편하도록 버튼 크기를 충분히 확보
* **상태 알림:** 충전/차감 완료 시 성공 메시지 노출, 잔액 부족 시 경고 알림
* **다크 모드 지원:** 카페 조명 환경에 따라 선택 가능한 테마

---

## 6. 향후 확장성 (Roadmap)
* **알림톡 연동:** 카카오톡 비즈메시지를 통한 잔액 변동 알림 발송
    * 충전 완료 시 잔액 안내
    * 잔액 부족 시 충전 권유 알림
    * 장기 미방문 고객 리마인드
* **영수증 출력:** 블루투스 프린터를 이용한 거래 확인증 출력
* **멀티 상점 지원:** 프랜차이즈 또는 다점포 운영자를 위한 통합 관리